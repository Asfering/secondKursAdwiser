# Документация по веб-приложению Adwiser
В этом документе описана документация разработчика веб-сайта системы Adwiser. Документ несёт в себе информацию о классах системы, страницах, процедурах, функциях, особенностях и подключенных библиотеках системы. Документация поможет разработчикам для дальнейшей поддержки проекта.
v1.0 - 11.05.2021. Пермь.
v1.1 - 17.05.2021. Пермь.
# Средства разработки
* Python - Язык программирования
* Bootstrap 5 - Фреймворк для работы с языками стилей CSS и программирования JavaScript
* HTML 5.0 - Язык разметки
* MS SQL Server - РСУБД системы

# Библиотеки
В данном проекте были подключены следующие библиотеки Python:
* flask - Библиотека для работы с фреймворком flask, на нём написан сам веб-сайт, требуется установка;
* pyodbc - Библиотека для подключения базы данных, требуется установка;
* flask_login - Библиотека для регистрации и авторизации пользователей на веб-сайте, требуется установка;
* random - Библиотека генерации случайного числа, идёт вместе с Python;
* datetime - Библиотека работы со временем, идёт вместе с Python.


# Базовые описания
В данной главе будут описаны основы по работе с веб-приложением.
Чтобы подключить класс к другому следует импортировать методы из подключаемого класса в иной.
Пример:
```
from fDataBase import fDataBase  
from UserLogin import UserLogin
```
В данном проекте **главным классом**, к которому следует подключать остальные, **является app**. Это важно для соединения различных модулей под одной системой.
## Запуск
Для корректного запуска веб-приложения следует описать имя, секретный ключ, конфиг и функцию вызова в классе:
```
app = Flask(__name__)  
SECRET_KEY= '327327373838382912ekdndd1210dqdqdjddsd1dasdqed3fd3er4f53445j' app.config['SECRET_KEY'] = SECRET_KEY

  
# Запуск сервера  
if __name__ == '__main__':  
    import os  
    HOST = os.environ.get('SERVER_HOST', 'localhost')  
    try:  
        PORT = int(os.environ.get('SERVER_PORT', '5555'))  
    except ValueError:  
        PORT = 5555  
  app.run(HOST, PORT)
```
## Связь с HTML-страницами
У каждого адресного пути должна быть своя функция, возвращающая html-страницу без или с некоторыми параметрами. 
Например:
```
@app.route('/')  
@app.route('/index')  
def hello():  
    if current_user.is_authenticated: # Если пользовать уже авторизован  
  return redirect(url_for('profile', user_id = current_user.get_id()))  
    # Default значение  
  return render_template('MainPage.html', title = 'Главная')
```
В примере выше описан возврат на отображение страницы MainPage.html с параметром title='Главная'. 
В случае, если необходимо перейти с текущей страницы на иную, следует вернуть перенаправление redirect с ключевым словом поиска url_for(*НазваниеФункции*, *параметры*).

Чтобы получить данные с клиента на сервер необходимо:
	1. Создать поле для ввода input с некоторым именем *Name* в HTML файле *htmlName*;
	2. В функции, возвращающей *htmlName*, передать некоторой переменной значение request.form[*Name*];
	3. Значение с клиента передастся в переменную на веб-приложение, а оттуда на сервер с помощью SQL запроса.
Пример из приложения:
```
HTML:
<input type="text" name="fstName" value="" size="51" placeholder = "Имя" requied /> <br>
Python:
if len(request.form['fstName']) > 1
```
## Пути
Путь должен описываться до определения функции, может содержать в себе параметры и данные о запросах. 
Например:
```
@app.route('/profile/<user_id>/registration', methods=["POST", "GET"])
```
В примере выше показан путь к функции RegTest, регистрация пользователей. В адресной строке клиента с ID = 2 будет описан путь: /profile/2/registration. 
Методы Post и Get указывают на то, что функция будет как показывать информацию с сервера на клиент (Get), так и получать данные от клиента на сервер (Post).
## Ошибки
В веб-приложении имеется возможность самостоятельно описать HTML ошибки в классе. Достаточно импортировать метод abort фреймворка Flask и прописать, например, следующее:
```
if not title:  
    abort(404)
    
@app.errorhandler(404)  
def http_404_handler(error):  
    '''Обработчик 404 ошибки'''  
  return "<p>HTTP 404 Error Encountered</p>", 404
```
## Сообщения пользователю
Чтобы отправить сообщение клиенту на форму достаточно написать текст в методе Flash, фреймворка Flask. 
Например:
```flash("У вас нет прав доступа к данной странице", "error") # Сообщение пользователю```
Имеется возможность передать данные о типе сообщения. В данной ситуации тип - error. Это поможет для определения типа и настройке подходящего цвета сообщения на html-странице.

## База данных
Скрипт базы данных лежит на гитхабе, текущего репозитория, ветки origin-main, папки DataBase.
Для работы с базой данных веб-сайту необходимо подключение. Для этого и существует библиотека pyodbc, описанная ранее. 
Процесс подключения к базе данных:
```
conn = None # Соединение  
mainCursor = None # Курсор БД

@app.before_request  
def before_request():  
    """Установление соединения с БД перед выполнением запроса"""  
  global conn  
    conn = pyodbc.connect(  
	 "Driver={ODBC Driver 17 for SQL Server};"  
	 "Server=DESKTOP-60EDRVH\SQLEXPRESS;" 
	 "Database=AdwiserLogDataBase;" 
	 "Trusted_Connection=yes;")  
  
    global mainCursor  
    mainCursor = conn.cursor()

@app.teardown_appcontext  
def close_db(error):  
    '''Закрываем соединение с БД, если оно было установлено'''  
  if hasattr(g, 'link_db'):  
        g.link_db.close()
```
В pyodbc.connect прописываются данные базы: 
* Driver = SQL Драйвер, установленный на компьютере;
* Server = Имя сервера (компьютера, машины);
* Database = Наименование базы данных;
* Trusted_Connection = Способ подключения к БД.

## SQL Запросы
В главе "База данных" были описаны основы подключения базы данных, выделены переменные для подключения *conn* и курсора подключения *mainCursor*. SQL Запросы будут писаться с применением этих ключевых слов.
Чтобы написать SQL запрос достаточно вызвать курсор подключения *mainCursor*, дописав расширение к нему *execute* с запросом в скобках. 
Например:
```mainCursor.execute(f"SELECT Users.UserLogin FROM Users WHERE UserLogin LIKE '{login}';") ```
В текущем примере login - атрибут, переданный в текущую функцию.
Важно помнить, что перед выполнением SQL запросов следует открывать доступ к изменению таблицы БД, прописывая: 
```
mainCursor.execute("SET IDENTITY_INSERT *ИмяБД* ON")
```
После выполнения запроса обязательно следует закрыть доступ к изменению таблицы БД.
```
mainCursor.execute("SET IDENTITY_INSERT *ИмяБД* OFF")
```
Чтобы получить данные из SQL запроса следует выписать кортеж данных в какую-либо переменную:
```
count = mainCursor.fetchone() - возвращает первую запись.
count = mainCursor.fetchall() - возвращает число записей в виде упорядоченного списка;
```
Чтобы получить элемент кортежа следует прописать ID элемента в списке:
```
return res[0]   # достаем 1-ый элемент кортежа
```
Чтобы сохранить базу данных после изменения следует прописать:
```
conn.commit()
```

## Авторизация пользователей flask_login
Сразу после подключения библиотеки flask_login следует установить некоторые константы при подключении:
```
login_manager = LoginManager(app)  
login_manager.login_view = 'login'  
login_manager.login_message = "Авторизуйтесь для доступа к закрытым страницам"  
login_manager.login_message_category = "error"
```
login_manager = объект класса LoginManager библиотеки flask_login
login_message используется как запись в flash-сообщении пользователю.
login_view и login_message_category передают значения о операции и классе сообщений.

Если страница должна быть открыта только авторизованному пользователю, следует перед функцией написать ключевые слова @login_required. 
Например:
```
@app.route('/profile/<user_id>/creatework', methods = ["POST","GET"])  
@login_required  
def createWork(user_id):
```
#### Авторизация на сайте
Код ниже содержит в себе авторизацию пользователя. Если пользователь уже авторизован, происходит перенаправление в профиль. Иначе проверяются логин и пароль на соответствие данным из БД. В случае правильности ввода создается объект класса UserLogin, пользователь авторизован, перенаправление в профиль. Иначе выходит сообщение об ошибке.
```
@app.route('/login', methods = ["POST", "GET"])  
def login():  
    '''Авторизация'''  
  # если пользователь уже авторизован  
  if current_user.is_authenticated:  
        return redirect(url_for('profile', user_id = current_user.get_id()))  
  
    # если метод пост  
  if request.method == "POST":  
        user = fDataBase.getUserByLogin(mainCursor, request.form['login'])  # поиск логина в бд  
	  psw = fDataBase.getUserPassword(mainCursor,request.form['login'])   # поиск пароля по логину в бд  
	  if user and psw[0] == request.form['psw']:  # если совпадают пароль и логин  
		  userlogin = UserLogin().create(user)    # авторизация пользователя, запоминаем ID текущего пользователя для дальнейшей работы  
		  login_user(userlogin)   # передаем объект класса UserLogin в login_user  
		  return redirect(url_for('profile', user_id = current_user.get_id()))    # переход в профиль  
	flash("Неверная пара логин/пароль", "error") # Иначе: Сообщение пользователю  
  return render_template("login.html", title = "Авторизация")
```
#### Регистрация новых пользователей
Код ниже содержит в себе регистрацию нового пользователя. Если пользователь администратор, он имеет право создавать новые аккаунты. Иначе произойдёт ошибка и пользователя перенаправит на страницу авторизации. С помощью команд SQL запросов SELECT и INSERT происходит процесс поиска и добавления пользователей.

#### Выход из системы
Для выхода из системы следует в первую очередь быть авторизованным. 
При выходе используется функция logout_user() библиотеки Flask_login. 
Пример:
```
@app.route('/logout')  
@login_required  
def logout():  
    '''Выход из системы'''  
  logout_user()  # login_manager в деле  
  flash("Вы вышли из аккаунта", "success")  # Сообщение пользователю  
  return redirect(url_for('login'))
```

#### Расширения
Если необходимо проверить кем именно является пользователь (роль на сайте) следует вызвать метод current_user.is_authenticated библиотеки flask_login. 
Например:
```
if current_user.is_authenticated: # Если пользовать уже авторизован  
  return redirect(url_for('profile', user_id = current_user.get_id()))
```
Если необходимо получить ID текущего пользователя следует прописать 
```current_user.get_id()```
Подробнее про расширения, связанные с авторизацией пользователя, будет описано в главе UserLogin
## Роли
Всего на сайте имеются 3 вида ролей:
* Студент
* Преподаватель
* Администратор

#### Пользователь
Пользователь - базовая роль на сайте. Остальные виды ролей являются дочерними.
Пользователь имеет право:
* Авторизоваться
* Открыть свой профиль
* Выйти из системы

#### Студент
Студент имеет право:
* Просматривать задания, выданные ему
* Отвечать на задания, выданные ему
* Просматривать историю заданий

#### Преподаватель
Преподаватель имеет право:
* Создавать задания студентам
* Просматривать ответы студентов на задания
* Просматривать все задания, выданные им же
* Комментировать задания студентов

#### Администратор
Администратор имеет право:
* Создавать нового пользователя
* Создание нового студента
* Создание нового преподавателя
## Аудит системы, Recording
При каждом изменении базы данных (добавление, удаление, изменение) происходит процесс записи истории в специальную таблицу Recording базы данных. Это нужно для того, чтобы видеть что, кем и когда было изменено. 
Вызов функции Recording происходит в каждой функции с изменением, добавлением или удалением. 
В списки записываются данные об изменении.
Пример такого вызова:
```
listA = [count[0], count[0], count[0], count[0]]  
listB = ["'Users'", "'Users'", "'Users'", "'Users'"]  
listC = ["'StudentID'", "'UserLogin'", "'UserPassword'", "'IsAdmin'"]  
listD = ["'Admin'", "'Admin'", "'Admin'", "'Admin'"]  
listE = ['Null', 'Null', 'Null', 'Null']  
listF = [count[0], f"'{login}'", f"'{psw}'", "'0'"]  
listOfLists = [listA, listB, listC, listD, listE, listF]  
Recording(listOfLists, 4)
```
Сама функция Recording(*Список списков*, *количество итераций массива*):
```
def Recording(listOfLists, numberOfIteration):  
    '''Добавление записей в БД. listOfLists = Лист Листов, numberOfIteration - Количество строк, необходимых внести в БД'''  
  mainCursor.execute("SET IDENTITY_INSERT Recording ON")  
    for i in range(numberOfIteration):  
        mainCursor.execute(f"Insert into Recording (RecordID, PKKeyOfTable, DateOfRecord, NameOfTable, NameOfColumn, Executor, OldValue, NewValue) \  
 VALUES ((Select count(Recording.RecordID) from Recording)+1,{listOfLists[0][i]}, GETDATE(), {listOfLists[1][i]}, {listOfLists[2][i]}, {listOfLists[3][i]}, {listOfLists[4][i]}, {listOfLists[5][i]})")  
    mainCursor.execute("SET IDENTITY_INSERT Recording OFF")  
    conn.commit()
```
Результат выполнения такого кода - создание 4 новых записей в таблице Recording.
## Пути подключения файлов
В некоторых файлах программы используется явный путь к исполняемым файлам.
Например, для подключения CSS стилей style.css файла в HTML-странице был прописан явный путь к файлу:
```
<link href="F:\python\secondKursAdwiser\SecondKursAdw\static\style.css" rel="stylesheet" type="text/css">
```
Для корректной работы системы Вам необходимо переопределить путь на себя, подстроить под свои папки.
## Папки
В проекте содержатся следующие папки:
* Database - Содержит в себе скрипт Базы данных;
* SecondKursAdw - Содержит в себе веб-приложение и модель адвайзера:
	* static - Содержит в себе статические элементы (стили, скрипты);
	* templates - Содержит в себе изменяемые элементы (html-страницы);
	* website - Модель Adwiser, система работы с эссе на английском языке;
	* Далее классы, описанные в главе Классы.
## Модель Adwiser
Модель Adwiser, с которым работает веб-приложение, находится в папке website. 
Система может работать некорректно, некоторые библиотеки могут отказать в подключении. На текущий момент Adwiser переписывается. По всем вопросам с моделью следует обращаться к Ирине (irinaproskurina128@gmail.com). 
Вся папка website содержит в себе все необходимые для работы системы данные. 

# Классы
В данной главе будет описание классов, их процедур и функций.
****
## Класс App
App - Главный файл, класс, веб-приложения. Именно тут происходит запуск веб-сайта. Остальные файлы проекта подключаются к app для дальнейшей работы.

## Процедуры и функции

## Hello()
**Принимает аргументов:** 0
**Аргументы:**  -
**Описание:** Функция стартовой страницы, принимает 2 пути: "/", "/index".
**Возвращает:** HTML-страницу "MainPage.html" с аргументами: title - Название страницы

## Before_request()
**Принимает аргументов:** 0
**Аргументы:**  -
**Описание:** Функция установления связи с БД
**Возвращает:**  -

## Close_db()
**Принимает аргументов:** 0
**Аргументы:**  -
**Описание:** Функция закрывает соединение с БД
**Возвращает:**  -

## RegTest(user_id)
**Принимает аргументов:** 1
**Аргументы:**  user_id - ID пользователя
**Описание:** Регистрация нового пользователя в БД
**Возвращает:**  HTML-страницу "testreg.html" с аргументами: title - Название страницы. 
**ЛИБО** перенаправление на другую страницу.

## AddUser(login, psw)
**Принимает аргументов:** 2
**Аргументы:**  login - Логин нового пользователя, psw - пароль нового пользователя
**Описание:** Вспомогательная функция регистрации пользователей, добавляет запись в БД
**Возвращает:**  True/False

## Recording(listOfLists, numberOfIteration)
**Принимает аргументов:** 1
**Аргументы:**  listOfLists - Список списков новых данных, numberOfIteration - количество итераций массива (количество необходимых новых записей в бд)
**Описание:** Аудит системы,  добавляет в БД информацию о всех изменениях на сервере.
**Возвращает:**  -

## CreateStudent(user_id)
**Принимает аргументов:** 1
**Аргументы:**  user_id - ID пользователя
**Описание:** Создание нового студента в системе
**Возвращает:**  HTML-страницу "createstudent.html" с аргументами: title - Название страницы. 
**ЛИБО** перенаправление на другую страницу.

## AddStudent(name, lastName, middleName, userId, groupId)
**Принимает аргументов:** 5
**Аргументы:**  name - Имя студента, lastName - фамилия студента, middleName - отчество студента (необяз.), userId - ID студента, groupID - ID группы студента
**Описание:** Вспомогательная функция регистрации студентов, добавляет запись в БД
**Возвращает:** True/False

## CreateProfessor(user_id)
**Принимает аргументов:** 1
**Аргументы:**  user_id - ID пользователя
**Описание:** Создание нового преподавателя в системе
**Возвращает:**  HTML-страницу "createprofessor.html" с аргументами: title - Название страницы. 
**ЛИБО** перенаправление на другую страницу.

## AddProfessor(name, lastName, middleName, userId)
**Принимает аргументов:** 4
**Аргументы:**  name - Имя преподавателя, lastName - фамилия преподавателя, middleName - отчество преподавателя (необяз.), userId - ID преподавателя
**Описание:** Вспомогательная функция регистрации преподавателей, добавляет запись в БД
**Возвращает:**  True/False

## login()
**Принимает аргументов:** 0
**Аргументы:**  -
**Описание:** Авторизация в системе
**Возвращает:**  HTML-страницу "login.html" с аргументами: title - Название страницы. 
**ЛИБО** перенаправление на другую страницу.

## createWork(user_id)
**Принимает аргументов:** 1
**Аргументы:** user_id - ID пользователя
**Описание:** Создание новой работы преподавателем
**Возвращает:**  HTML-страницу "createWork.html" с аргументами: title - Название страницы. 
**ЛИБО** перенаправление на другую страницу.

## AddWork(nameOfWork, Task, numberOfGroup, year, month, day, hour, minute):
**Принимает аргументов:** 8
**Аргументы:** nameOfWork - Наименование работы, Task - задание, numberOfGroup - номер группы студентов, year - год дедлайна, month - месяц дедлайна, day - день дедлайна, hour - час дедлайна, minute - минута дедлайна
**Описание:** Вспомогательная функция создания работ, добавляет запись в БД
**Возвращает:**  True/False

## profile(user_id)
**Принимает аргументов:** 1
**Аргументы:** user_id - ID пользователя
**Описание:** Открытие профиля пользователя
**Возвращает:**  HTML-страницу "profiledefault.html" с аргументами: title - Название страницы. 
**ЛИБО** HTML-страницу "profiletchr.html" с аргументами: title - Название страницы, nameOfTeacher - ФИО преподавателя, role - роль пользователя на сайте 
**ЛИБО** HTML-страницу "profilestd.html" с аргументами: title - Название страницы, nameOfStudent - ФИО студента, role - роль пользователя на сайте, tasksBeforeDeadline - задания до дедлайна, tasksAfterDeadline - задания после дедлайна
**ЛИБО** HTML-страницу "profileadm.html" с аргументами: title - Название страницы, nameOfAdmin - ФИО админа

## showTask(user_id, id_post)
**Принимает аргументов:** 2
**Аргументы:** user_id - ID пользователя, id_post - ID Задания
**Описание:** Просмотр задания, выданного преподавателем; только для студента
**Возвращает:**  _**Если дедлайн прошёл:**_ HTML-страницу "task.html" с аргументами: title - Название страницы, task - задание, DateOfBeginHTML - дата создания задания, DateOfEndHTML - дата дедлайна,  professorHTML - ФИО преподавателя, tf - прошёл ли дедлайн, post - ID задания
**ЛИБО:** _**Если дедлайн ещё не прошёл:**_ HTML-страницу "task.html" с аргументами: title - Название страницы, task - задание, DateOfBeginHTML - дата создания задания, DateOfEndHTML - дата дедлайна,  professorHTML - ФИО преподавателя, tf - прошёл ли дедлайн, post - ID задания, sea - зона ввода эссе студента, rea - зона вывода результата по эссе студента, ge - оценка за работу, ce - комментарий преподавателя, doue - дата отправки эссе, eu - есть ли такое эссе в бд

## CreateEssayResponce(user_id, post_id, stdResponce)
**Принимает аргументов:** 3
**Аргументы:** user_id - ID пользователя, post_id - ID задания, stdResponce - эссе студента
**Описание:** Вспомогательная функция добавления ответа на задание студентом, добавляется запись в БД
**Возвращает:**  True/False

## checkonwarnings(user_id)
**Принимает аргументов:** 1
**Аргументы:** user_id - ID пользователя
**Описание:** Проверка эссе на наличие ошибок без записи в БД, доступно всем пользователям
**Возвращает:**  HTML-страницу "checkonwarnings.html" с аргументами: title - Название страницы, grade - оценка за работу, sea - зона ввода эссе пользователя, rea - зона вывода результата по эссе пользователя, tf - true/false значение

## showWorksByMe(user_id):
**Принимает аргументов:** 1
**Аргументы:** user_id - ID пользователя
**Описание:** Показывает все работы за преподавателя, которые он выдал, только для преподавателя
**Возвращает:**  HTML-страницу "wrkbyme.html" с аргументами: title - Название страницы, tasksBeforeDeadline - задания до дедлайна, tasksAfterDeadline - задания после дедлайна
**ЛИБО** перенаправление на другую страницу.

## essayResp(post_id, user_id):
**Принимает аргументов:** 1
**Аргументы:** user_id - ID пользователя, post_id - ID задания
**Описание:** Просмотр всех ответов студентов на задание, только для преподавателя
**Возвращает:**  HTML-страницу "essayresponse.html" с аргументами: title - Название страницы, nameOfWork - имя работы, task - задание (осн. информация), responses - все ответы студентов 
**ЛИБО** перенаправление на другую страницу.

## ShowEssays(post_id, user_id, student_id)
**Принимает аргументов:** 3
**Аргументы:** user_id - ID пользователя, post_id - ID задания, student_id - ID студента
**Описание:** Просмотр эссе определенного студента за преподавателя, только для преподавателя
**Возвращает:**  HTML-страницу "essay.html" с аргументами: title - Название страницы, task - задание (осн. информация), essay - эссе студента, result - проверенное эссе студента, titleEs - наименование задания, grade - оценка за эссе, dateOfUpload - дата загрузки эссе, comment - комментарий преподавателя к эссе студента, post - ID задания, student - ID студента
**ЛИБО** перенаправление на другую страницу.

## UpdateComment(comment, post_id, comOldEssay, student_id)
**Принимает аргументов:** 4
**Аргументы:** post_id - ID задания, student_id - ID студента, comment - новый комментарий преподавателя, comOldEssay - старый комментарий преподавателя
**Описание:** Изменение комментария к работе студента преподавателем, запись в БД
**Возвращает:**  True/False

## logout()
**Принимает аргументов:** 0
**Аргументы:** -
**Описание:** Выход из системы
**Возвращает:**  Перенаправление на страницу "login"

## http_404_handler(error)
**Принимает аргументов:** 1
**Аргументы:** error - Ошибка
**Описание:** Обработчик ошибки 404
**Возвращает:**  Надпись об ошибке 404

## http_500_handler(error)
**Принимает аргументов:** 1
**Аргументы:** error - Ошибка
**Описание:** Обработчик ошибки 500
**Возвращает:**  Надпись об ошибке 500

****

## Класс fDataBase

## getUser(user_id, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** user_id - ID пользователя, mainCursor - Курсор базы данных
**Описание:** Получение пользователя из БД
**Возвращает:**  Объект "Пользователь" / False

## getUserPassword(mainCursor, login)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, login - Логин пользователя
**Описание:** Поиск пароля по логину в БД
**Возвращает:**  Пароль / False

## getUserByLogin(mainCursor, login):
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, login - Логин пользователя
**Описание:** Поиск логина в БД
**Возвращает:**  Логин / False

## getProffesorByTask(mainCursor, id_post):
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, id_post - ID работы
**Описание:** Получение ФИО преподавателя по ID задания
**Возвращает:**  ФИО преподавателя / False

## getTask(mainCursor, id_post):
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, id_post - ID работы
**Описание:** Получение работы по ID
**Возвращает:**  Работа / False

## getIdTaskBeforeDeadline(mainCursor, id_post):
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, id_post - ID работы
**Описание:** Функция получения ID работы, у которой НЕ прошёл дедлайн работы
**Возвращает:**  True / False

## getTaskBeforeDeadline(mainCursor, currentID)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, currentID - ID студента
**Описание:** Функция получения задания работы, у которой НЕ прошёл дедлайн
**Возвращает:**  Работа / False

## getTaskAfterDeadline(mainCursor, currentID)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, currentID - ID студента
**Описание:**Функция получения задания работы, у которой прошёл дедлайн
**Возвращает:**  Работа / False

## getTaskAnnonceByMe(mainCursor, currentID)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, currentID - ID преподавателя
**Описание:** Функция получения ID и наименования работы по ID профессора ДО дедлайна
**Возвращает:**  Работа / False

## getTaskAnnonceByMeAfterDeadLine(mainCursor, currentID):
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, currentID - ID преподавателя
**Описание:** Функция получения ID и наименования работы по ID профессора ПОСЛЕ дедлайна
**Возвращает:**  Работа / False

## isEssayFromDB(mainCursor, idPost, UserId)
**Принимает аргументов:** 3
**Аргументы:** mainCursor - Курсор базы данных, idPost - ID работы, UserId - ID пользователя 
**Описание:** Функция определения, находится ли данное эссе в бд
**Возвращает:**  True / False

## idEssayFromDB(mainCursor, idPost, UserId)
**Принимает аргументов:** 3
**Аргументы:** mainCursor - Курсор базы данных, idPost - ID работы, UserId - ID пользователя 
**Описание:** Функция определения, находится ли данное эссе в бд
**Возвращает:**  ID эссе / False

## getEssayFromDB(mainCursor, idPost, UserId)
**Принимает аргументов:** 3
**Аргументы:** mainCursor - Курсор базы данных, idPost - ID работы, UserId - ID пользователя 
**Описание:** Функция получения эссе из БД
**Возвращает:**  Эссе / False

## getWorkName(mainCursor, idPost):
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, idPost - ID работы
**Описание:** Функция получения наименование работы по ID работы
**Возвращает:**  Имя работы / False

## getWorkTask(mainCursor, idPost)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, idPost - ID работы
**Описание:** Функция получения задания работы по ID работы
**Возвращает:**  Задание работы / False

## getEssayResponse(professorID, mainCursor, idPost)
**Принимает аргументов:** 3
**Аргументы:** mainCursor - Курсор базы данных, idPost - ID работы, professorID - ID преподавателя
**Описание:** Функция получения ФИО студента, ID работы и ID студента по ID преподавателя и работы
**Возвращает:**  ФИО студента, ID работы и ID студента / False

## getMainInfoEssay(idPost, idStudent, mainCursor)
**Принимает аргументов:** 3
**Аргументы:** mainCursor - Курсор базы данных, idPost - ID работы, idStudent - ID студента
**Описание:** Функция получения основной информации по эссе из БД по ID студента и работы
**Возвращает:**  Основная информация по эссе из БД / False

## getUserIdByStudentId(student_id, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, student_id - ID студента
**Описание:** Получение ID пользователя по ID студента
**Возвращает:**  ID пользователя / False
****
## Класс UserLogin
Аргумент **self** - указывается текущий объект класса

## fromDb(self, user_id, mainCursor)
**Принимает аргументов:** 3
**Аргументы:** user_id - ID пользователя, mainCursor - Курсор базы данных, self
**Описание:** Процесс создание объекта класса UserLogin
**Возвращает:**  Объект класса UserLogin

## create(self, user)
**Принимает аргументов:** 2
**Аргументы:** user - объект класса UserLogin, self
**Описание:** Функция создания нового пользователя
**Возвращает:**  Объект класса UserLogin

## is_authenticated(self)
**Принимает аргументов:** 1
**Аргументы:** self
**Описание:** Функция проверки, авторизован ли пользователь
**Возвращает:**  True

## is_active(self)
**Принимает аргументов:** 1
**Аргументы:** self
**Описание:** Функция проверки, активен ли пользователь
**Возвращает:**  True

## is_anonymous(self)
**Принимает аргументов:** 1
**Аргументы:** self
**Описание:** Функция проверки, аноним ли пользователь
**Возвращает:**  False

## get_id(self)
**Принимает аргументов:** 1
**Аргументы:** self
**Описание:** Функция получения ID пользователя
**Возвращает:**  ID пользователя

## is_admin(self, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, self
**Описание:** Функция проверяющая, является ли пользователь админом
**Возвращает:**  True / False

## is_student(self, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, self
**Описание:** Функция проверяющая, является ли пользователь студентом
**Возвращает:**  True / False

## is_professor(self, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, self
**Описание:** Функция проверяющая, является ли пользователь преподавателем
**Возвращает:**  True / False

## id_of_student(self, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, self
**Описание:** Функция получения ID студента
**Возвращает:** ID преподавателя / False

## id_of_professor(self, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, self
**Описание:** Функция получения ID преподавателя
**Возвращает:** ID преподавателя / False

## name_of_student(self, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, self
**Описание:** Функция получения имени студента
**Возвращает:** Имя студента / False

## name_of_professor(self, mainCursor)
**Принимает аргументов:** 2
**Аргументы:** mainCursor - Курсор базы данных, self
**Описание:** Функция получения имени преподавателя
**Возвращает:**  Имя преподавателя / False
***
# HTML-страницы
В данной главе будут описаны все HTML-страницы, используемые в приложении
***
## Базовый - base.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Страница является основой для некоторых. Используется на страницах, где в шапке находится кнопка "Авторизация"
**Путь к странице:** -
**Родитель:** -
**Потомки:** login.html; MainPage.html; profiledefault.html; 

## Базовый - baseSecond.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Страница является основой для некоторых. Используется на страницах, где в шапке находятся кнопки "Профиль" и "Выход из профиля"
**Путь к странице:** -
**Родитель:** -
**Потомки:** checkonwarnings.html; createprofessor.html; createstudent.html; createWork.html; essay.html; essayresponse.html; task.html; testreg.html; wrkbyme.html

## Профиль - Админ - profileadm.html
**Принимает аргументов:** 3
**Аргументы:** title - наименование страницы, role - роль пользователя, nameOfAdmin - ФИО администратора
**Описание:** Страница является профилем пользователя с ролью "Администратор". Содержит в себе некоторую часть кнопок; *открывается только администратору*
**Путь к странице:** /profile/<user_id>
**Родитель:** -
**Потомки:** -

## Профиль - Преподаватель - profiletchr.html
**Принимает аргументов:** 3
**Аргументы:** title - наименование страницы, role - роль пользователя, nameOfTeacher - ФИО преподавателя
**Описание:** Страница является профилем пользователя с ролью "Преподаватель". Содержит в себе некоторую часть кнопок, таблиц; *открывается только преподавателю*
**Путь к странице:** /profile/<user_id>
**Родитель:** -
**Потомки:** -

## Профиль - Студент- profilestd.html
**Принимает аргументов:** 5
**Аргументы:** title - наименование страницы, role - роль пользователя, nameOfStudent - ФИО преподавателя, tasksBeforeDeadline - задания до дедлайна, tasksAfterDeadline - задания после дедлайна
**Описание:** Страница является профилем пользователя с ролью "Студент". Содержит в себе некоторую часть кнопок, таблиц; *открывается только студенту*
**Путь к странице:** /profile/<user_id>
**Родитель:** -
**Потомки:** -

## checkonwarnings.html
**Принимает аргументов:** 5
**Аргументы:** title - наименование страницы, grade - оценка за работу, sea - эссе на входе, rea - эссе на выходе, user_id - ID пользователя, tf - true/false проверка
**Описание:** Страница отображает функцию checkonwarnings, позволяющую всем пользователям проверять эссе на наличие ошибок без записи в БД. Содержит в себе кнопки и текстовые поля;  *открывается всем авторизованным пользователям*
**Путь к странице:** /profile/<user_id>/checkonwarnings
**Родитель:** baseSecond.html
**Потомки:** -

## createprofessor.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Страница отображает функцию CreateProfessor, позволяющую создавать новых преподавателей из уже существующих пользователей. Содержит в себе кнопки и текстовые поля;  *открывается только администратору*
**Путь к странице:** /profile/<user_id>/createprofessor
**Родитель:** baseSecond.html
**Предки:** -

## createstudent.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Страница отображает функцию CreateStudent, позволяющую создавать новых студентов из уже существующих пользователей. Содержит в себе кнопки и текстовые поля;  *открывается только администратору*
**Путь к странице:** /profile/<user_id>/createstudent
**Родитель:** baseSecond.html
**Предки:** -

## createWork.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Страница отображает функцию createWork, позволяющую создавать новые задания студентам. Содержит в себе кнопки и текстовые поля; *открывается только преподавателю*
**Путь к странице:** /profile/<user_id>/creatework
**Родитель:** baseSecond.html
**Предки:** -

## essay.html
**Принимает аргументов:** 10
**Аргументы:** title - наименование страницы, result - результат проверки эссе, comment - комментарий преподавателя, post - ID ответа на задание, student - ID студента, grade - оценка за работу, titleEs - наименование эссе, dateOfUpload - дата загрузки, task - задание, essay - эссе студента
**Описание:** Страница отображает функцию ShowEssays, позволяющую просматривать эссе некоторого студента преподавателю. Содержит в себе кнопки и текстовые поля; *открывается только преподавателю*
**Путь к странице:** /profile/<user_id>/worksbyme/<post_id>/<student_id>
**Родитель:** baseSecond.html
**Предки:** -

## essayresponse.html
**Принимает аргументов:** 4
**Аргументы:** title - наименование страницы, task - задание, nameOfWork - наименование задания, responses - ответы всех студентов на задание
**Описание:** Страница отображает функцию essayResp, позволяющую открыть все ответы студентов на определенное задание. Содержит в себе кнопки и таблицы; *открывается только преподавателю*
**Путь к странице:** /profile/<user_id>/worksbyme/<post_id>
**Родитель:** baseSecond.html
**Предки:** -

## login.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Страница открывается для ввода данных для авторизации пользователя на сайте. Содержит кнопки и текстовые поля; *открывается всем пользователям*
**Путь к странице:** /login
**Родитель:** base.html
**Предки:** -

## MainPage.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Является стартовой страницей веб-приложения. Содержит кнопки; *открывается всем пользователям*
**Путь к странице:** /
**Родитель:** base.html
**Предки:** -

## task.html
**Принимает аргументов:** 7-13
**Аргументы:** _**Если дедлайн прошёл:**_ title - Название страницы, task - задание, DateOfBeginHTML - дата создания задания, DateOfEndHTML - дата дедлайна,  professorHTML - ФИО преподавателя, tf - прошёл ли дедлайн, post - ID задания
**ЛИБО:** _**Если дедлайн ещё не прошёл:**_ title - Название страницы, task - задание, DateOfBeginHTML - дата создания задания, DateOfEndHTML - дата дедлайна,  professorHTML - ФИО преподавателя, tf - прошёл ли дедлайн, post - ID задания, sea - зона ввода эссе студента, rea - зона вывода результата по эссе студента, ge - оценка за работу, ce - комментарий преподавателя, doue - дата отправки эссе, eu - есть ли такое эссе в бд
**Описание:** Страница отображает функцию showTask, позволяющую открывать задание преподавателя и отвечать на него студенту. Содержит в себе кнопки; *открывается только студенту*
**Путь к странице:** /profile/<user_id>/task/<id_post>
**Родитель:** baseSecond.html
**Предки:** -

## testreg.html
**Принимает аргументов:** 1
**Аргументы:** title - наименование страницы
**Описание:** Страница отображает функцию RegTest, позволяющую создавать новых пользователей. Содержит в себе кнопки и текстовые поля;  *открывается только администратору*
**Путь к странице:** /profile/<user_id>/registration
**Родитель:** baseSecond.html
**Предки:** -

## wrkbyme.html
**Принимает аргументов:** 3
**Аргументы:** title - наименование страницы
**Описание:** Страница отображает функцию showWorksByMe, позволяющую просматривать все задания, выданные преподавателем. Содержит в себе кнопки и таблицы;  *открывается только преподавателю*
**Путь к странице:** /profile/<user_id>/worksbyme/
**Родитель:** baseSecond.html
**Предки:** -

# Таблицы базы данных
## Works
**Количество столбцов:** 8
**Столбцы:**
* WorkID - PK, int, not null - ID Работы;
* ProfessorsID - FK, int, not null - ID преподавателя, выдавшего работу;
* Task - nvarchar(4000), not null - Информация о задании;
* DateOfBegin - datetime, null - Дата создания;
* DateOfEnd - datetime, null - Дата конца срока сдачи;
* NameOfWork - nvarchar(4000), not null - Наименование работы;
* UrlOfWork - nvarchar(4000), null - URL работы, *не используется*;
* GroupID - FK, int, null - Номер группы, которой выдали задание.

**Связи:** Один-ко-многим: Professors (ProfessorID), Groups (GroupID),  Essay (WorkId);
**Описание:** Таблица содержит в себе данные по всем работам, выданным преподавателями студентам.

## Essay
**Количество столбцов:** 8
**Столбцы:**
* EssayID - PK, int, not null - ID Эссе, которое отправил студент;
* WorkID - FK, int, null - ID работы, на основе которой написано эссе;
* UserID - FK, int, null - ID пользователя, отправившего эссе (препод / студент);
* StudentEssay - nvarchar(4000), not null - Эссе студента;
* ResultEssay - nvarchar(4000), not null - Результат проверки эссе студента;
* Grade - int, not null - Оценка за работу студента;
* Comment - nvarchar(4000), not null - Комментарий преподавателя;
* DateOfUpload - datetime, null - Дата загрузки эссе студентом.

**Связи:** Один-ко-многим: Users (UserID), Works (WorkId);
**Описание:** Таблица содержит в себе все эссе всех студентов.

## Users
**Количество столбцов:** 4
**Столбцы:**
* UserId - PK, int, not null - ID пользователя;
* UserLogin - nvarchar(50), not null - Login пользователя;
* UserPassword - nvarchar(50), not null - Password пользователя;
* IsAdmin - bit, not null - Является ли пользователь администратором.

**Связи:** Один-ко-многим: Essay (UserId), Professors (UserId), Students (UserId);
**Описание:** Таблица является основой для авторизации и регистрации пользователей на сайте, содержит данные о пользователях.

## Professors
**Количество столбцов:** 5
**Столбцы:**
* ProfessorID - PK, int, not null - ID преподавателя;
* UserID - FK, int, not null - ID пользователя;
* ProfessorFirstName - nvarchar(50), not null - Имя преподавателя;
* ProfessorLastName - nvarchar(50), not null - Фамилия преподавателя;
* ProfessorMiddleName - nvarchar(50), null - Отчество преподавателя.

**Связи:** Один-ко-многим: Works (ProfessorID), Users (UserId);
**Описание:** Таблица содержит в себе данные по всем преподавателям.

## Students
**Количество столбцов:** 6
**Столбцы:**
* StudentID - PK, int, not null - ID студента;
* UserID - FK, int, not null - ID пользователя;
* StudentFirstName - nvarchar(50), not null - Имя преподавателя;
* StudentLastName - nvarchar(50), not null - Фамилия преподавателя;
* StudentMiddleName - nvarchar(50), null - Отчество преподавателя;
* GroupId - FK, int, null - ID группы, к которой принадлежит студент.

**Связи:** Один-ко-многим: Groups (GroupID),  Users (UserId);
**Описание:** Таблица содержит в себе данные по всем студентам.

## Groups
**Количество столбцов:** 3
**Столбцы:**
* GroupId - PK, int, not null - ID группы;
* CourseID - FK, int, null - ID курса;
* NumberOfGroup - int, null - номер курса.

**Связи:** Один-ко-многим: Course (CourseID), Students(GroupID), Works (GroupID)
**Описание:** Таблица содержит в себе данные по группам.


## Course
**Количество столбцов:** 3
**Столбцы:**
* CourseID - PK, int, not null - ID курса;
* DirectionID - FK, int, null - ID направления;
* CourseNameID - FK, int, null - ID имени курса.

**Связи:** Один-ко-многим: Direction (DirectionID), CourseNames (CourseNameID), Groups (CourseID);
**Описание:** Таблица связывает направление и наименование курса воедино.

## CourseNames
**Количество столбцов:** 3
**Столбцы:**
* CourseNameID - PK, int, not null - ID имени курса;
* NameOfCourse - int, not null - Номер курса;
* LevelOfCourse - nvarchar(50), not null - Уровень обучения (бакалавр, магистратура, специалитет).

**Связи:** Один-ко-многим: Course (CourseNameID);
**Описание:** Таблица содержит информацию о номере и уровне курса.

## Direction
**Количество столбцов:** 2
**Столбцы:**
* DirectionID - PK, int, not null - ID направления;
* DirectionName - nvarchar(50), not null - Наименование направления

**Связи:** Один-ко-многим: Course (DirectionID);
**Описание:** Таблица содержит информацию о наименовании направлений обучения.

## Recording
**Количество столбцов:** 8
**Столбцы:**
* RecordID - PK, int, not null - ID записи;
* DateOfRecord - datetime, null - Дата и время записи;
* NameOfTable - nvarchar(4000), null - Наименование таблицы, где произошло изменение;
* NameOfColumn - nvarchar(4000), null - Наименование колонки, в которой произошло изменение;
* Executor - nvarchar(4000), null - Исполнитель изменения (админ, препод и т.д.);
* OldValue - nvarchar(4000), null - Старое значение;
* NewValue - nvarchar(4000), null - Новое значение;
* PKKeyOfTable - nvarchar(4000), null - В какой строке таблицы произошло изменение.

**Связи:** -
**Описание:** Аудит, таблица содержит в себе данные о всех изменениях в системе.
***

# Заключение
В данном документе были описаны классы, страницы, процедуры, функции, таблицы бд, особенности и библиотеки системы. Прочтение документа поможет понять суть работы с веб-приложением. Со временем будет дополняться. 
11.05.2021. Пермь.
